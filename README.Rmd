---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(benchlingapi)

# mock for the sake of output
get_users <- function() {
structure(list(email = c("jamey@example.com", "peggy@example.com", 
"gabriel@example.com", "felix@example.com", "garett@example.com"), handle = c("jamey", "peggy", "gabriel", "felix", 
"garett"), id = c("ent_SPXdAvAd", "ent_N3ARMuA4", 
"ent_og8mNFAy", "ent_CXxJcHK2", "ent_qac9DiQn"), name = c("Jamey Olson", "Peggy Paucek", "Gabriel Toy", 
"Felix Rohan", "Garett Donnelly")), row.names = c(NA, 
5L), class = "data.frame")
}
```

# benchlingapi

<!-- badges: start -->
<!-- badges: end -->

Connect to the benchling API via R.

## Installation

You can install the development version of benchlingapi like so:

```{r, eval = FALSE}
# install.packages("remotes")
remotes::install_github("HIBio/benchlingapi")

library(benchlingapi)
```

## Authentication

Set up the following environment variables for easy access (e.g. using `usethis::edit_r_environ()`)

``` bash
BENCHLING_ORG=yourorgname
BENCHLING_TOKEN=sk_dMAQaaa9AaAAwwADRAzAs2AAz4Aaa
```

## Example

```{r}
get_users()
```

## Supported Endpoints

Most of the endpoints have been automatically wrapped, but there is no guarantee that they work.

The endpoints which should be wrapped are
```{r, echo = FALSE}
c("aa_sequences", "apps", "assay_result_schemas", "assay_results", 
"assay_run_schemas", "assay_runs", "automation_file_transforms", 
"automation_input_generators", "automation_output_processors", 
"batch_schemas", "batches", "blobs", "box_schemas", "boxes", 
"container_schemas", "containers", "custom_entities", "dna_alignments", 
"dna_oligos", "dna_sequences", "dropdowns", "entities", "entity_schemas", 
"entries", "entry_schemas", "entry_templates", "events", "exports", 
"feature_libraries", "features", "folders", "legacy_workflow_stage_runs", 
"legacy_workflow_stages", "legacy_workflows", "location_schemas", 
"locations", "mixtures", "molecules", "oligos", "organizations", 
"plate_schemas", "plates", "projects", "registries", "request_fulfillments", 
"request_schemas", "request_task_schemas", "requests", "result_transactions", 
"rna_oligos", "tasks", "teams", "token", "transfers", "users", 
"warehouse_credentials", "workflow_outputs", "workflow_stage_runs", 
"workflow_stages", "workflow_task_groups", "workflow_task_schemas", 
"workflow_tasks", "workflows")
```

Some of these take an additional (optional) parameter (only one supported for now)

```{r, echo = FALSE}
structure(list(endpoint = c("aa_sequences", "apps", "assay_result_schemas", 
"assay_results", "assay_run_schemas", "assay_runs", "automation_file_transforms", 
"automation_input_generators", "automation_output_processors", 
"batch_schemas", "batches", "blobs", "box_schemas", "boxes", 
"container_schemas", "containers", "custom_entities", "dna_alignments", 
"dna_oligos", "dna_sequences", "dropdowns", "entities", "entity_schemas", 
"entries", "entry_schemas", "entry_templates", "feature_libraries", 
"features", "folders", "legacy_workflow_stage_runs", "legacy_workflow_stages", 
"legacy_workflows", "location_schemas", "locations", "mixtures", 
"molecules", "oligos", "organizations", "plate_schemas", "plates", 
"projects", "registries", "request_fulfillments", "request_schemas", 
"request_task_schemas", "requests", "result_transactions", "rna_oligos", 
"tasks", "teams", "users", "workflow_outputs", "workflow_stage_runs", 
"workflow_stages", "workflow_task_groups", "workflow_task_schemas", 
"workflow_tasks", "workflows"), parameter = c("{aa_sequence_id}", 
"{app_id}", "{schema_id}", "{assay_result_id}", "{schema_id}", 
"{assay_run_id}", "{transform_id}", "{input_generator_id}", "{output_processor_id}", 
"{schema_id}", "{batch_id}", "{blob_id}", "{schema_id}", "{box_id}", 
"{schema_id}", "{container_id}", "{custom_entity_id}", "{dna_alignment_id}", 
"{oligo_id}", "{dna_sequence_id}", "{dropdown_id}", "{entity_id}", 
"{schema_id}", "{entry_id}", "{schema_id}", "{entry_template_id}", 
"{feature_library_id}", "{feature_id}", "{folder_id}", "{stage_run_id}", 
"{stage_id}", "{legacy_workflow_id}", "{schema_id}", "{location_id}", 
"{mixture_id}", "{molecule_id}", "{oligo_id}", "{organization_id}", 
"{schema_id}", "{plate_id}", "{project_id}", "{registry_id}", 
"{request_fulfillment_id}", "{schema_id}", "{schema_id}", "{request_id}", 
"{transaction_id}", "{oligo_id}", "{task_id}", "{team_id}", "{user_id}", 
"{workflow_output_id}", "{stage_run_id}", "{stage_id}", "{workflow_task_group_id}", 
"{schema_id}", "{workflow_task_id}", "{workflow_id}")), row.names = c(NA, 
-58L), class = c("data.frame"))
```

Many endpoints also include query parameters (see the [official reference](https://benchling.com/api/reference)).
These can be specified via the `...` argument, and are detailed in the individual help for each function.

```{r, eval = FALSE}
?get_organizations
```

----

```{r, echo = FALSE, results='asis'}
help_console <- function(topic, package,
                         format=c("text", "html", "latex", "Rd"),
                         before=NULL, after=NULL) {
  # topic - the command for which help is required
  # package - the package name with the required topic
  # format - output format
  # before - place code before the output e.g. "<blockquote>"
  # after - place code after the output e.g. "</blockquote>"

  # based on code by Noam Ross
  #  http://www.noamross.net/archives/2013-06-18-helpconsoleexample/
  # St√©phane Laurent
  #  https://stackoverflow.com/questions/60468080/
  #   print-an-r-help-file-vignette-as-output-into-an-r-html-notebook
  # and Michael Sumner (mdsumner)
  #  https://stackoverflow.com/questions/7495685/
  #   how-to-access-the-help-documentation-rd-source-files-in-r

  format <- match.arg(format)
  if (!is.character(topic)) topic <- deparse(substitute(topic))
  db <- tools::Rd_db(package)
  helpfile <- db[paste0(topic, ".Rd")][[1]]

  hs <- capture.output(
    switch(
      format,
      text = tools::Rd2txt(helpfile),
      html = tools::Rd2HTML(
        helpfile,
        package = "",
        stages = c("install", "render")
      ),
      latex = tools::Rd2latex(helpfile),
      Rd = tools:::prepare_Rd(helpfile)
    )
  )
  if (format == "html") {
    i <- grep("<h2>", hs)
    j <- grep("</body>", hs)
    hs <- hs[(i-1):(j-1)]
  }
  hs <- c(before, hs, after)
  hs <- cat(hs, sep = "\n")
  invisible(hs)
}

help_console("users", "benchlingapi", format = "html")
```

----

As an example, if your users list has several users with the name 'David'

```{r, eval = FALSE}
get_users(nameIncludes = "david")
```
```{r, echo = FALSE}
structure(list(email = c("david.old@example.com", "david.new@example.com"
), handle = c("david.new", "david.old"), id = c("ent_U2gA6a41", "ent_AvA2sA2X"
), name = c("David New", "David Old")), class = "data.frame", row.names = 1:2)
```
